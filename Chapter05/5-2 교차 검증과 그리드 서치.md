# 5-2. 교차 검증과 그리드 서치

### 💍 검증 세트 (validation set)

하이퍼파라미터 튜닝을 위해 모델을 평가할 때, 테스트 세트를 사용하지 않기 위해 훈련 세트에서 다시 떼어 낸 데이터 세트

❓테스트/검증 세트에 얼마나 많은 샘플을 덜어놔야 할까?

보통 20 ~ 30%를 테스트 세트와 검증 세트로 떼어 놓는다. 훈련 데이터가 아주 많다면 단 몇 %만 떼어 놓아도 전체 데이터를 대표하는 데 문제가 없다. 

훈련세트에서 모델 훈련 → 검증 세트로 모델 평가 → 매개변수 바꿔가며 가장 좋은 모델 선택 

→ 이 매개변수를 사용해 훈련 세트와 검증 세트를 합쳐 전체 훈련 데이터에서 모델을 다시 훈련 

→ 마지막으로 테스트 세트에서 최종 점수를 평가

### ⚔️ 교차 검증 (cross validation)

훈련 세트를 여러 폴드로 나눈 다음 한 폴드가 검증 세트의 역할을 하고 나머지 폴드에서는 모델을 훈련한다. 교차 검증은 이런 식으로 모든 폴드에 대해 검증 점수를 얻어 평균하는 방법이다. 

교차 검증을 이용하면 안정적인 검증 점수를 얻고 훈련에 더 많은 데이터를 사용할 수 있다. 

**3-폴드 교차 검증**

훈련 세트를 세 부분으로 나눠서 교차 검증을 수행하는 것. 통칭 **k-폴드 교차 검증(k-fold cross validation)**이라고 하며, 훈련 세트를 몇 부분으로 나누냐에 따라 다르게 부른다. k-겹 교차 검증이라고도 부른다. 

### 😵‍💫 하이퍼파라미터 튜닝

하이퍼파라미터 : 모델이 학습할 수 없어서 사용자가 지정해야만 하는 파라미터

[하이퍼파라미터 튜닝]

1. 먼저 라이브러리가 제공하는 기본값을 그대로 사용
2. 검증 세트의 점수나 교차 검증을 통해서 매개변수를 조금씩 변경
3. 매개변수를 바꿔가면서 모델을 훈련하고 교차 검증을 수행

** 여러 개의 매개변수를 동시에 바꿔가며 최적의 값을 찾아야 한다! 한 매개변수의 최적값은 다른 매개변수 값이 바뀌면 함께 달라지기 때문.

**그리드 서치 (Grid Search)**

하이퍼파라미터 탐색과 교차 검증을 한 번에 수행. 

하이퍼파라미터 탐색을 자동화해 주는 도구. 탐색할 매개변수를 나열하면 교차 검증을 수행하여 가장 좋은 검증 점수의 매개변수 조합을 선택한다. 마지막으로 이 매개변수 조합으로 최종 모델을 훈련한다. 

1. 먼저 탐색할 매개변수를 지정한다.
2. 그다음 훈련 세트에서 그리드 서치를 수행하여 최상의 평균 검증 점수가 나오는 매개변수 조합을 찾는다. 이 조합은 그리드 서치 객체에 저장된다.
3. 그리드 서치는 최상의 매개변수에서 (교차 검증에 사용한 훈련 세트가 아니라) 전체 훈련 세트를 사용해 최종 모델을 훈련한다. 이 모델도 그리드 서치 객체에 저장된다. 

**랜덤 서치 (Random Search)**

연속된 매개변수 값을 탐색할 때 유용하다. 탐색할 값을 직접 나열하는 것이 아니고 탐색 값을 샘플링할 수 있는 확률 분포 객체를 전달한다. 지정된 횟수만큼 샘플링하여 교차 검증을 수행하기 때문에 시스템 자원이 허락하는 만큼 탐색량을 조절할 수 있다. 

### 👩‍💻 scikit-learn

- `cross_validate()` : 교차 검증을 수행하는 함수
    - `scoring` : 검증에 사용할 평가 지표 (분류 모델 → accuracy, 회귀 모델 → r2)
    - `cv` : 교차 검증 폴드 수나 스필리터 객체 (기본값 : 5) (회귀 → `StratifiedKFold`, 분류 → `KFold`)
    - `n_jobs` : 교차 검증을 수행할 때 사용할 CPU 코어 수 (기본값 : 1, 모든 코어 : -1)
    - `return_train_score` : True로 지정하면 훈련 세트의 점수도 반환, 기본값은 False
- GridSearchCV : 교차 검증으로 하이퍼파라미터 탐색을 수행. 최상의 모델을 찾은 후 훈련 세트 전체를 사용해 최종 모델을 훈련
    - 첫 번째 매개변수로 그리드 서치를 수행할 모델 객체를 전달하고, 두 번째 매개변수로 탐색할 모델의 매개변수와 값을 전달한다.
- RandomizedSearchCV : 교차 검증으로 랜덤한 하이퍼파라미터 탐색을 수행. 최상의 모델을 찾은 후 훈련 세트 전체를 사용해 최종 모델을 훈련.
    - 첫 번째 매개변수로 랜덤 서치를 수행할 모델 객체를 전달하고, 두 번째 매개변수로 탐색할 모델의 매개변수와 확률 분포 객체를 전달한다.